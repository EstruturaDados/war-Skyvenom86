#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

#define TOTAL 5
#define DADO_MAX 6

// Estrutura do territﾃｳrio
struct Territorio {
    char nome[30];
    char cor[10];
    int tropas;
};

/* ================= FUNﾃﾃ髭S ================= */

// Inicializa automaticamente os territﾃｳrios
void inicializarTerritorios(struct Territorio *t) {
    const char *nomes[TOTAL] = {
        "Brasil", "Argentina", "Chile", "Peru", "Colombia"
    };

    const char *cores[TOTAL] = {
        "Vermelho", "Verde", "Azul", "Amarelo", "Verde"
    };

    for (int i = 0; i < TOTAL; i++) {
        strcpy(t[i].nome, nomes[i]);
        strcpy(t[i].cor, cores[i]);
        t[i].tropas = 3;
    }
}

// Exibe o mapa atual
void exibirMapa(const struct Territorio *t) {
    printf("\n=== MAPA ATUAL ===\n");
    for (int i = 0; i < TOTAL; i++) {
        printf("[%d] %s | Cor: %s | Tropas: %d\n",
               i + 1, t[i].nome, t[i].cor, t[i].tropas);
    }
}

// Sorteio de dado
int rolarDado(void) {
    return rand() % DADO_MAX + 1;
}

// Simulaﾃｧﾃ｣o de ataque
void atacar(struct Territorio *t) {
    int atacante, defensor;
    int dadoAtaque, dadoDefesa;

    exibirMapa(t);

    printf("\nEscolha o territﾃｳrio ATACANTE (1 a 5): ");
    scanf("%d", &atacante);

    printf("Escolha o territﾃｳrio DEFENSOR (1 a 5): ");
    scanf("%d", &defensor);

    if (atacante < 1 || atacante > TOTAL ||
        defensor < 1 || defensor > TOTAL ||
        atacante == defensor) {
        printf("Escolha invﾃ｡lida!\n");
        return;
    }

    if (t[atacante - 1].tropas < 2) {
        printf("Territﾃｳrio atacante nﾃ｣o possui tropas suficientes!\n");
        return;
    }

    dadoAtaque = rolarDado();
    dadoDefesa = rolarDado();

    printf("\nDado Ataque: %d", dadoAtaque);
    printf("\nDado Defesa: %d\n", dadoDefesa);

    if (dadoAtaque > dadoDefesa) {
        t[defensor - 1].tropas--;
        printf("Ataque venceu! Defensor perdeu 1 tropa.\n");

        if (t[defensor - 1].tropas == 0) {
            printf("Territﾃｳrio conquistado!\n");
            strcpy(t[defensor - 1].cor, t[atacante - 1].cor);
            t[defensor - 1].tropas = 1;
            t[atacante - 1].tropas--;
        }
    } else {
        t[atacante - 1].tropas--;
        printf("Defesa venceu ou empate! Atacante perdeu 1 tropa.\n");
    }
}

// Verifica missﾃ｣o: destruir o exﾃｩrcito verde
int missaoExercitoVerde(const struct Territorio *t) {
    for (int i = 0; i < TOTAL; i++) {
        if (strcmp(t[i].cor, "Verde") == 0) {
            return 0; // Ainda existe verde
        }
    }
    return 1; // Missﾃ｣o concluﾃｭda
}

// Verifica missﾃ｣o: conquistar 3 territﾃｳrios
int missaoConquista(const struct Territorio *t, const char *corJogador) {
    int contador = 0;

    for (int i = 0; i < TOTAL; i++) {
        if (strcmp(t[i].cor, corJogador) == 0) {
            contador++;
        }
    }

    return (contador >= 3);
}

// Verifica se alguma missﾃ｣o foi concluﾃｭda
void verificarMissao(const struct Territorio *t, const char *corJogador) {
    if (missaoExercitoVerde(t)) {
        printf("\n醇 MISSﾃグ CONCLUﾃ好A: Exﾃｩrcito Verde destruﾃｭdo!\n");
        exit(0);
    }

    if (missaoConquista(t, corJogador)) {
        printf("\n醇 MISSﾃグ CONCLUﾃ好A: 3 territﾃｳrios conquistados!\n");
        exit(0);
    }

    printf("\nMissﾃｵes ainda nﾃ｣o concluﾃｭdas.\n");
}

/* ================= MAIN ================= */

int main() {

    int opcao;
    const char corJogador[] = "Vermelho";

    srand(time(NULL));

    struct Territorio *territorios;
    territorios = (struct Territorio *) calloc(TOTAL, sizeof(struct Territorio));

    if (territorios == NULL) {
        printf("Erro de alocaﾃｧﾃ｣o de memﾃｳria!\n");
        return 1;
    }

    inicializarTerritorios(territorios);

    do {
        printf("\n=== MENU PRINCIPAL ===\n");
        printf("1 - Atacar\n");
        printf("2 - Verificar Missﾃ｣o\n");
        printf("0 - Sair\n");
        printf("Escolha: ");
        scanf("%d", &opcao);

        switch (opcao) {
            case 1:
                atacar(territorios);
                break;
            case 2:
                verificarMissao(territorios, corJogador);
                break;
            case 0:
                printf("Encerrando o jogo...\n");
                break;
            default:
                printf("Opﾃｧﾃ｣o invﾃ｡lida!\n");
        }

    } while (opcao != 0);

    free(territorios);
    return 0;
}
